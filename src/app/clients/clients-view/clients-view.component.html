<mat-card class="client-card rounded-lg !bg-transparent">
  <mat-card-header
    fxLayout="column"
    class="header rounded-lg mb-8 border-[#DFE5EC] shadow-[0px_1px_2px_0px_rgba(16,24,40,0.05)] overflow-hidden"
  >
    <mat-card-title-group class="header-title-group">
      <div class="profile-image-container">
        <div>
          <img
            alt=""
            mat-card-md-image
            class="profile-image"
            [src]="clientImage ? clientImage : 'assets/images/user_placeholder.png'"
          />
        </div>
        <div fxLayoutAlign="center center" class="m-b-5">
          <button
            class="client-image-button"
            mat-raised-button
            (click)="doAction('Upload Image')"
            matTooltip="Upload Image"
            *mifosxHasPermission="'CREATE_CLIENTIMAGE'"
          >
            <i class="fa fa-upload"></i>
          </button>
          <button
            class="client-image-button"
            mat-raised-button
            (click)="doAction('Capture Image')"
            matTooltip="Capture Image"
            *mifosxHasPermission="'CREATE_CLIENTIMAGE'"
          >
            <i class="fa fa-camera"></i>
          </button>
          <button
            class="client-image-button"
            mat-raised-button
            (click)="doAction('Delete Image')"
            matTooltip="Delete Image"
            *mifosxHasPermission="'DELETE_CLIENTIMAGE'"
          >
            <i class="fa fa-trash"></i>
          </button>
          <br />
        </div>
        <button (click)="doAction('View Signature')" class="bg-blue-700 text-white !rounded text-xs py-[4px] px-[8px]">
          View Signature
        </button>
      </div>

      <div class="mat-typography client-card-title">
        <mat-card-title fxLayout="row wrap" class="content">
          <h3 fxFlex="95%">
            <i
              class="fa fa-stop"
              [ngClass]="clientViewData.status.code | statusLookup"
              [matTooltip]="clientViewData.status.value"
            ></i>
            <span class="text-[#6A6C6A] font-medium">Client Name :</span
            ><mifosx-entity-name
              class="text-[#0e0f0c] font-semibold"
              entityName="{{ clientViewData.displayName }}"
            ></mifosx-entity-name>
          </h3>
          <div fxFlex="5%">
            <button mat-icon-button [matMenuTriggerFor]="clientMenu" aria-label="Client actions" yPosition="below">
              <mat-icon matListIcon class="actions-menu">
                <fa-icon icon="bars" size="sm" style="color: #0e0f0c"></fa-icon>
              </mat-icon>
            </button>
          </div>
        </mat-card-title>

        <mat-card-subtitle>
          <div class="grid gap-y-1">
            <span class="flex gap-x-2 items-center">
              <span class="text-[#6A6C6A] font-medium">Office :</span
              ><mifosx-entity-name
                class="text-[#0e0f0c] font-semibold"
                entityName="{{ clientViewData.officeName }}"
              ></mifosx-entity-name>
            </span>
            <span class="flex gap-x-2 items-center">
              <span class="text-[#6A6C6A] font-medium">Client :</span>
              <mifosx-account-number
                class="text-[#0e0f0c] font-semibold"
                accountNo="{{ clientViewData.accountNo }}"
              ></mifosx-account-number>
            </span>
            <span class="flex gap-x-2 items-center">
              <span class="text-[#6A6C6A] font-medium">External Id:</span
              ><mifosx-external-identifier
                class="text-[#0e0f0c] !font-semibold"
                externalId="{{ clientViewData.externalId }}"
                completed="true"
              ></mifosx-external-identifier>
            </span>
            <span class="flex gap-x-2 items-center" *ngIf="clientViewData.staffName"
              ><span class="text-[#6A6C6A] font-medium">Staff :</span
              ><span class="text-[#0e0f0c] font-semibold"> {{ clientViewData.staffName || "Unassigned" }}</span></span
            >
            <span class="flex gap-x-2 items-center" *ngIf="clientViewData.activationDate"
              ><span class="text-[#6A6C6A] font-medium">Activation Date :</span>
              <span class="text-[#0e0f0c] font-semibold"> {{ clientViewData.activationDate | dateFormat }}</span></span
            >
            <span class="flex gap-x-2 items-center" *ngIf="clientViewData.groups.length > 0">
              <span class="text-[#6A6C6A] font-medium"> Member Of :</span>
              <span *ngFor="let group of clientViewData.groups" class="text-[#0e0f0c] font-semibold">
                <span>{{ group.name }}</span
                >&nbsp;
              </span>
            </span>
            <br />
          </div>
        </mat-card-subtitle>
      </div>

      <mat-menu #clientMenu="matMenu">
        <button mat-menu-item [routerLink]="['edit']" *mifosxHasPermission="'UPDATE_CLIENT'">
          <mat-icon matListIcon class="!mr-1">
            <fa-icon icon="edit" size="sm"></fa-icon>
          </mat-icon>
          <span>Edit</span>
        </button>

        <button *ngIf="isActive()" mat-menu-item [matMenuTriggerFor]="accountApplications">
          <mat-icon matListIcon class="!mr-1">
            <fa-icon icon="money-bill-alt" size="sm"></fa-icon>
          </mat-icon>
          <span>Applications</span>
        </button>

        <button mat-menu-item [matMenuTriggerFor]="Actions">
          <mat-icon matListIcon class="!mr-1">
            <fa-icon icon="tasks" size="sm"></fa-icon>
          </mat-icon>
          <span>Actions</span>
        </button>

        <button mat-menu-item (click)="doAction('Assign Staff')" *ngIf="!clientViewData.staffId">
          <mat-icon matListIcon class="!mr-1">
            <fa-icon icon="user-tie" size="sm"></fa-icon>
          </mat-icon>
          <span>Assign Staff</span>
        </button>

        <span *ngIf="clientViewData.staffId">
          <button mat-menu-item *mifosxHasPermission="'UNASSIGNSTAFF_CLIENT'" (click)="doAction('Unassign Staff')">
            <mat-icon matListIcon class="!mr-1">
              <fa-icon icon="user-tie" size="sm"></fa-icon>
            </mat-icon>
            <span>Unassign Staff</span>
          </button>
        </span>

        <button mat-menu-item [matMenuTriggerFor]="More">More</button>
      </mat-menu>

      <mat-menu #accountApplications="matMenu">
        <button mat-menu-item *mifosxHasPermission="'CREATE_LOAN'" [routerLink]="['loans-accounts', 'create']">
          New Loan Account
        </button>
        <button
          mat-menu-item
          *mifosxHasPermission="'CREATE_SAVINGSACCOUNT'"
          [routerLink]="['savings-accounts', 'create']"
        >
          New Savings Account
        </button>
        <button mat-menu-item *mifosxHasPermission="'CREATE_SHAREACCOUNT'" [routerLink]="['shares-accounts', 'create']">
          New Share Account
        </button>
        <button
          mat-menu-item
          *mifosxHasPermission="'CREATE_RECURRINGDEPOSITACCOUNT'"
          [routerLink]="['recurringdeposits', 'create-recurring-deposits-account']"
        >
          New Recurring Deposit Account
        </button>
        <button
          mat-menu-item
          *mifosxHasPermission="'CREATE_FIXEDDEPOSITACCOUNT'"
          [routerLink]="['fixed-deposits-accounts', 'create']"
        >
          New Fixed Deposits Account
        </button>
      </mat-menu>

      <mat-menu #Actions="matMenu">
        <button mat-menu-item (click)="doAction('Close')">Close</button>
        <button mat-menu-item (click)="doAction('Transfer Client')">Transfer Client</button>
        <span *ngIf="clientViewData.status.value === 'Pending'"
          ><button mat-menu-item (click)="doAction('Activate')">Activate</button></span
        >
        <span *ngIf="clientViewData.status.value === 'Pending'"
          ><button mat-menu-item (click)="doAction('Withdraw')">Withdraw</button></span
        >
        <span *ngIf="clientViewData.status.value === 'Pending'"
          ><button mat-menu-item (click)="doAction('Reject')">Reject</button></span
        >
        <span *ngIf="clientViewData.status.value === 'Pending'"
          ><button mat-menu-item *mifosxHasPermission="'DELETE_CLIENT'" (click)="doAction('Delete')">
            Delete
          </button></span
        >
        <span *ngIf="clientViewData.status.value === 'Closed'"
          ><button mat-menu-item (click)="doAction('Reactivate')">Reactivate</button></span
        >
        <span *ngIf="clientViewData.status.value === 'Rejected'"
          ><button mat-menu-item (click)="doAction('Undo Rejection')">Undo Rejection</button></span
        >
        <span *ngIf="clientViewData.status.value === 'Transfer in progress'"
          ><button mat-menu-item (click)="doAction('Undo Transfer')">Undo Transfer</button></span
        >
        <span *ngIf="clientViewData.status.value === 'Transfer in progress'"
          ><button mat-menu-item (click)="doAction('Accept Transfer')">Accept Transfer</button></span
        >
        <span *ngIf="clientViewData.status.value === 'Transfer in progress'"
          ><button mat-menu-item (click)="doAction('Reject Transfer')">Reject transfer</button></span
        >
      </mat-menu>

      <mat-menu #More="matMenu">
        <button mat-menu-item (click)="doAction('Add Charge')" *mifosxHasPermission="'CREATE_CLIENTCHARGE'">
          Add Charge
        </button>
        <button mat-menu-item (click)="doAction('Create Collateral')">Create Collateral</button>
        <button mat-menu-item (click)="doAction('Survey')">Survey</button>
        <button
          mat-menu-item
          (click)="doAction('Update Default Savings')"
          *mifosxHasPermission="'UPDATESAVINGSACCOUNT_CLIENT'"
        >
          Update Default Savings
        </button>
        <button mat-menu-item (click)="doAction('Upload Signature')" *mifosxHasPermission="'CREATE_CLIENTIMAGE'">
          Upload Signature
        </button>
        <button mat-menu-item (click)="doAction('Delete Signature')" *mifosxHasPermission="'DELETE_CLIENTIMAGE'">
          Delete Signature
        </button>
        <button mat-menu-item (click)="doAction('Client Screen Reports')">Client Screen Reports</button>
        <button
          mat-menu-item
          (click)="doAction('Create Standing Instructions')"
          *mifosxHasPermission="'CREATE_STANDINGINSTRUCTION'"
        >
          Create Standing Instructions
        </button>
        <span *ngIf="clientViewData.status.value != 'Transfer on hold'">
          <button
            mat-menu-item
            (click)="doAction('View Standing Instructions')"
            *mifosxHasPermission="'READ_STANDINGINSTRUCTION'"
          >
            View Standing Instructions
          </button>
        </span>
        <button mat-menu-item (click)="doAction('Create Self Service User')">Create Self Service User</button>
      </mat-menu>
    </mat-card-title-group>
  </mat-card-header>

  <mat-card-content
    class="border border-[#DFE5EC] shadow-[0px_1px_2px_0px_rgba(16,24,40,0.05)] overflow-hidden rounded-lg bg-white"
  >
    <nav mat-tab-nav-bar class="navigation-tabs">
      <a
        mat-tab-link
        [routerLink]="['./general']"
        routerLinkActive
        #general="routerLinkActive"
        [active]="general.isActive"
      >
        General
      </a>
      <a
        mat-tab-link
        [routerLink]="['./address']"
        routerLinkActive
        #address="routerLinkActive"
        [active]="address.isActive"
      >
        Address
      </a>
      <a
        mat-tab-link
        [routerLink]="['./family-members']"
        routerLinkActive
        #familyMembers="routerLinkActive"
        [active]="familyMembers.isActive"
      >
        Family Members
      </a>
      <a
        mat-tab-link
        [routerLink]="['./identities']"
        routerLinkActive
        #identities="routerLinkActive"
        [active]="identities.isActive"
        *mifosxHasPermission="'READ_CLIENTIDENTIFIER'"
      >
        Identities
      </a>
      <a
        mat-tab-link
        [routerLink]="['./documents']"
        routerLinkActive
        #documents="routerLinkActive"
        [active]="documents.isActive"
        *mifosxHasPermission="'READ_DOCUMENT'"
      >
        Documents
      </a>
      <a
        mat-tab-link
        [routerLink]="['./notes']"
        routerLinkActive
        #notes="routerLinkActive"
        [active]="notes.isActive"
        *mifosxHasPermission="'READ_CLIENTNOTE'"
      >
        Notes
      </a>
      <ng-container *ngFor="let clientDatatable of clientDatatables">
        <a
          mat-tab-link
          [routerLink]="['./datatables', clientDatatable.registeredTableName]"
          routerLinkActive
          #datatable="routerLinkActive"
          [active]="datatable.isActive"
          *mifosxHasPermission="'READ_' + clientDatatable.registeredTableName"
        >
          {{ clientDatatable.registeredTableName }}
        </a>
      </ng-container>
    </nav>

    <router-outlet></router-outlet>
  </mat-card-content>
</mat-card>
